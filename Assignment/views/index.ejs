<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <title>Document</title>
  </head>
  <body>
    <div>
      <button
        class="btn btn-primary float-end"
        data-bs-toggle="modal"
        data-bs-target="#exampleModal"
      >
        Add user
      </button>
    </div>
    <div class="container-fluid mt-4">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>UserID</th>
            <th>Username</th>
            <th>Fullname</th>
            <th>Address</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach((element,index) => { %>
          <tr>
            <td><%= element._id %></td>
            <td><%= element.username %></td>
            <td><%= element.fullname %></td>
            <td><%= element.address %></td>
            <td>
              <!-- <a href="/add" class="btn btn-primary">Add</a> -->
              <a
                href="/api/delete/<%= element._id %>"
                class="btn btn-danger delete-user"
                >Delete</a
              >
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="m-auto">
          <div class="modal-content p-3">
            <form action="/add" method="post">
              <div class="mb-3 mt-3">
                <label for="name" class="form-label">Username:</label>
                <input
                  type="text"
                  class="form-control"
                  id="username"
                  placeholder="Enter username"
                  name="username"
                />
              </div>
              <div class="mb-3">
                <label for="pwd" class="form-label">Fullname:</label>
                <input
                  type="text"
                  class="form-control"
                  id="fullname"
                  placeholder="Enter fullname"
                  name="fullname"
                />
              </div>
              <div class="mb-3">
                <label for="pwd" class="form-label">Address:</label>
                <input
                  type="text"
                  class="form-control"
                  id="address"
                  placeholder="Enter address"
                  name="address"
                />
              </div>
              <button
                type="button"
                class="btn btn-primary"
                id="add-user-btn"
                data-bs-dismiss="modal"
              >
                Add
              </button>
              <button
                type="button"
                class="btn btn-danger"
                data-bs-dismiss="modal"
              >
                Exit
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script>
      $(document).on("click", ".delete-user", function (e) {
        let nut = $(this);
        let url = $(this).attr("href");
        $.ajax({
          type: "delete",
          url: url,
          // data: "data",
          // dataType: "dataType",
          success: function (response) {
            // alert(response);
            nut.parent().parent().hide();
          },
        });
        e.preventDefault();
      });

      // Add user

      $("#add-user-btn").click(function (e) {
        e.preventDefault();
        let user = {};
        user.username = $("#username").val();
        user.fullname = $("#fullname").val();
        user.address = $("#address").val();
        $.ajax({
          type: "post",
          url: "/add",
          data: user,
          success: function (response) {
            let user = response;
            let resultHTML = `<tr>
                                <td>${user._id}</td>
                                <td>${user.username}</td>
                                <td>${user.fullname}</td>
                                <td>${user.address}</td>
                                <td> 
                                  <a href="/api/delete/${user._id}" class="btn btn-danger delete-user">Delete</a>
                                </td>
                              </tr>`;
            $("tbody").append(resultHTML);
          },
        });
      });
    </script>
  </body>
</html>
